# Test configuration for iterator expansion (clocks, sources, and values)

iterators:
  - name: i
    type: range
    start: 0
    end: 2

  - name: region
    type: list
    values: [us, eu]

templates:
  clocks:
    # Clock templates with iterator expansion
    # Expands to: template_tick_0_us, template_tick_0_eu, template_tick_1_us, template_tick_1_eu, template_tick_2_us, template_tick_2_eu
    - name: template_tick_{i}_{region}
      type: periodic
      interval: 1s

  sources:
    # Source templates with iterator expansion
    # Expands to: template_events_0_us, template_events_0_eu, template_events_1_us, template_events_1_eu, template_events_2_us, template_events_2_eu
    - name: template_events_{i}_{region}
      type: random_int
      clock:
        template: template_tick_{i}_{region}
      min: 0
      max: 100

  values:
    # Value templates with iterator expansion
    # Expands to: template_total_0_us, template_total_0_eu, template_total_1_us, template_total_1_eu, template_total_2_us, template_total_2_eu
    - name: template_total_{i}_{region}
      source:
        template: template_events_{i}_{region}
      transforms: [accumulate]

instances:
  clocks:
    # Clock instances with iterator expansion
    # Expands to: tick_0_us, tick_0_eu, tick_1_us, tick_1_eu, tick_2_us, tick_2_eu
    - name: tick_{i}_{region}
      type: periodic
      interval: 1s

  sources:
    # Source instances with iterator expansion
    # Expands to: events_0_us, events_0_eu, events_1_us, events_1_eu, events_2_us, events_2_eu
    - name: events_{i}_{region}
      type: random_int
      clock:
        instance: tick_{i}_{region}
      min: 0
      max: 100

  values:
    # Value instances with iterator expansion referencing expanded sources
    # Expands to: total_events_0_us, total_events_0_eu, total_events_1_us, total_events_1_eu, total_events_2_us, total_events_2_eu
    - name: total_events_{i}_{region}
      source:
        instance: events_{i}_{region}
      transforms: [accumulate]

    # Value instance using template source reference
    - name: total_template_events_0_eu
      source:
        template: template_events_0_eu
      transforms: [accumulate]

metrics:
  - name: test_events_total
    type: counter
    description: "Test metric using expanded instance clock, source, and value"
    value:
      instance: total_events_0_us
    attributes:
      region: us
      index: "0"

  - name: test_template_events_total
    type: counter
    description: "Test metric using expanded template value"
    value:
      template: template_total_0_eu
    attributes:
      region: eu
      index: "0"

export:
  prometheus:
    enabled: true
    port: 9090
    path: /metrics

settings:
  seed: 12345
